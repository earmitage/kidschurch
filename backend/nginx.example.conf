# Nginx Configuration Example for Church Games Backend
# 
# This configuration handles:
# - Reverse proxy to Gunicorn/Uvicorn backend
# - Large file uploads (up to 15MB for PDFs)
# - CORS headers (if needed)
# - SSL/TLS termination
#
# Place this in your Nginx sites-available directory and symlink to sites-enabled
# Example: /etc/nginx/sites-available/kidschurch-backend

server {
    listen 80;
    server_name kidschurch.bylwazi.co.za;
    
    # Redirect HTTP to HTTPS (uncomment if using SSL)
    # return 301 https://$server_name$request_uri;
    
    # For development/testing without SSL, uncomment the location block below
    # and comment out the redirect above
    location /kidschurch-backend/ {
        include proxy_params;
        proxy_pass http://127.0.0.1:5001/;
        
        # CRITICAL: Allow large file uploads (PDFs can be up to 10MB)
        # Default Nginx limit is 1MB, which causes 413 errors
        client_max_body_size 15M;
        
        # Increase timeouts for large uploads
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
        proxy_send_timeout 300s;
        
        # Buffer settings for large requests
        proxy_buffering off;
        proxy_request_buffering off;
        
        # Headers
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# HTTPS Configuration (uncomment and configure if using SSL)
# server {
#     listen 443 ssl http2;
#     server_name kidschurch.bylwazi.co.za;
#     
#     # SSL Certificate paths (update with your actual paths)
#     ssl_certificate /etc/letsencrypt/live/kidschurch.bylwazi.co.za/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/kidschurch.bylwazi.co.za/privkey.pem;
#     
#     # SSL Configuration (recommended settings)
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers HIGH:!aNULL:!MD5;
#     ssl_prefer_server_ciphers on;
#     
#     location /kidschurch-backend/ {
#         include proxy_params;
#         proxy_pass http://127.0.0.1:5001/;
#         
#         # CRITICAL: Allow large file uploads
#         client_max_body_size 15M;
#         
#         # Increase timeouts for large uploads
#         proxy_read_timeout 300s;
#         proxy_connect_timeout 75s;
#         proxy_send_timeout 300s;
#         
#         # Buffer settings
#         proxy_buffering off;
#         proxy_request_buffering off;
#         
#         # Headers
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
# }

# Notes:
# 1. The path /kidschurch-backend/ should match your frontend's API base URL
# 2. Update server_name with your actual domain
# 3. The backend runs on port 5001 by default (adjust if different)
# 4. After making changes, test with: sudo nginx -t
# 5. Reload Nginx: sudo systemctl reload nginx

